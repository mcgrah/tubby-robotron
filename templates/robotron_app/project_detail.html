{% extends "base_scripted.html"%}

{% block title %}Project: {{ project.name }}{% endblock %}

{% block minicrumbs %}
<li class="breadcrumb-item"><a href="{% url "projects" %}">Projects</a></li>
<li class="breadcrumb-item active" aria-current="page">{{ project.name }}</li>
{% endblock %}

{% block page_alerts %}
    <div class="alert alert-warning">
    {% if  project.batch_count != batch_list.count  %}
        <p>! Number of batches different than declared: (current: {{ batch_list.count }}, expected: {{ project.batch_count }} )</p>
    {% endif %}
    {% if  total_chars != project.char_count  %}
        <p class="mb-0">! Number of characters different than declared: (current: {{ total_chars|default_if_none:0 }}, expected: {{ project.char_count }} )</p>
    {% endif %}
    </div>
{% endblock %}
{% block content %}

    <div class="row align-items-center">
        <div class="col-md-auto">
            <h4>{{ project.name }}</h4>
        </div>
        <div class="col">
            <a role=button class="btn btn-outline-primary" href="{% url "update_project" pk=project.id %}">Edit</a>
        </div>
    </div>
    <hr>
    <div class="row">
    <div class="col">
    <table class="table table-striped table-sm">
        <tbody>
        <tr><th scope="row">Studio: </th><td><a href="{{ project.studio.get_absolute_url }}">{{ project.studio.name }}</a></td></tr>
        <tr><th scope="row">Director: </th><td>{{ project.director.name }}</td></tr>
        <tr><th scope="row">Batches: </th><td>{{ project.batch_count }}</td></tr>
        <tr><th scope="row">Files: </th><td>{{ project.files_count }}</td></tr>
        <tr><th scope="row">Words: </th><td>{{ project.word_count }}</td></tr>
        <tr><th scope="row">Characters: </th><td>{{ project.char_count }}</td></tr>
        <tr><th scope="row">Actors: </th><td>{{ project.actor_count }}</td></tr>
        <tr><th scope="row">SFX: </th><td>{{ project.sfx_note }}</td></tr>
        <tr><th scope="row">TC: </th><td>{{ project.tc_note }}</td></tr>
        </tbody>
    </table>
    </div>
        <div class="col"></div>
    </div>
    <hr>
    <h4>Batches:</h4>
    <div class="btn-group">
        <button type="button" class="btn btn-outline-primary" data-toggle="collapse" data-target="#batchForm" aria-pressed="false" aria-expanded="false">Add New</button>
{#        <button>Import CSV</button>#}
    </div>
    {% load i18n widget_tweaks %}
    <form action="" method="POST" id="batch-form">
        {% csrf_token %}
        {% if form.errors %}
        <div class="form-row collapse show" id="batchForm">
        {% else %}
        <div class="form-row collapse" id="batchForm">
        {% endif %}
            {% for field in form %}
            {% if field.errors %}
                <div class="form-group has-error col-md-2">
                    <label class="control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                    {{ field|attr:"class:form-control" }}
                    <div class="alert alert-danger">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </div>
                </div>
            {% else %}
                <div class="form-group col-md-2">
                    <label class="control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                    {{ field|attr:"class:form-control" }}
                </div>
            {% endif %}
        {% endfor %}
        <div class="form-group col-md-2">
                <button type="submit" class="btn btn-primary">{% trans "Submit" %}</button>
                <a class="btn btn-primary" href="{{ project.get_absolute_url }}" role="button">Clear</a>
        </div>
        </div>
    </form>
    {% if batch_list %}
        <table class="table table-borderless table-sm table-hover">
            <tr>
                <th scope="col">#</th>
                <th scope="col">Name</th>
                <th scope="col">Start Date</th>
                <th scope="col">Deadline</th>
                <th scope="col">Files</th>
                <th scope="col">Words</th>
                <th scope="col">Characters</th>
                <th scope="col">Sessions</th>
            </tr>
        {% for batch in batch_list %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ batch.name }}</td>
                <td>{{ batch.start_date }}</td>
                <td>{{ batch.deadline }}</td>
                <td>{{ batch.files_count }}</td>
                <td>{{ batch.word_count }}</td>
                <td>{{ batch.char_count }}</td>
                <td><a href="{{ batch.get_absolute_url }}">View Details</a></td>
            </tr>
        {% endfor %}

        </table>
    {% else %}
       <div class="alert alert-info">No batches added.</div>
    {% endif %}
{% endblock %}